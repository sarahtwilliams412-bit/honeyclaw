app = 'honeyclaw-ssh'
primary_region = 'sjc'

# Build from project root so src/ modules are available in context
[build]
  dockerfile = "templates/basic-ssh/Dockerfile"

# Persistent volume for logs and SSH host key
[mounts]
  source = "honeyclaw_data"
  destination = "/data"

[env]
  PORT = "8022"
  LOG_PATH = "/data/logs/ssh.json"
  HOST_KEY_PATH = "/data/ssh_host_key"

# HTTP health check on the health endpoint
[[services]]
  protocol = "tcp"
  internal_port = 8022
  auto_stop_machines = "off"
  auto_start_machines = true
  min_machines_running = 1

  [[services.ports]]
    port = 8022

# Health check via TCP on SSH port
[[services]]
  protocol = "tcp"
  internal_port = 9090
  auto_stop_machines = "off"
  auto_start_machines = true
  min_machines_running = 0

  [[services.ports]]
    port = 9090
    handlers = ["http"]

  [services.http_checks]
    interval = 15000
    timeout = 5000
    path = "/health"
